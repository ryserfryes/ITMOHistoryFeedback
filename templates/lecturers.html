{% extends 'base.html' %}
{% block content %}
<h1>–õ–µ–∫—Ç–æ—Ä—ã</h1>

<div class="container-fluid">
  <table class="table table-hover" id="lecturers-table">
    <thead class="table-light">
      <tr>
        <th scope="col" class="sortable text-start" data-sort="name" style="cursor: pointer; user-select: none;">
          –õ–µ–∫—Ç–æ—Ä <span class="sort-arrow">‚Üï</span>
        </th>
        <th scope="col" class="sortable text-center" data-sort="complexity" style="cursor: pointer; user-select: none;">
          –°–ª–æ–∂–Ω–æ—Å—Ç—å <span class="sort-arrow">‚Üï</span>
        </th>
        <th scope="col" class="sortable text-center" data-sort="interest" style="cursor: pointer; user-select: none;">
          –ò–Ω—Ç–µ—Ä–µ—Å <span class="sort-arrow">‚Üï</span>
        </th>
        <th scope="col" class="sortable text-center" data-sort="reviews" style="cursor: pointer; user-select: none;">
          –û—Ç–∑—ã–≤—ã <span class="sort-arrow">‚Üï</span>
        </th>
      </tr>
    </thead>
    <tbody>
      {% for lec in lecturers %}
      <tr class="lecturer-row" data-name="{{ lec.name }}" data-complexity="{{ lec.complexity_avg or 0 }}"
        data-interest="{{ lec.interest_avg or 0 }}" data-reviews="{{ lec.reviews }}">
        <td class="text-start">
          <a href="{{ url_for('lecturer_detail', name=lec.name) }}" class="text-decoration-none lecturer-link" data-lecturer="{{ lec.name }}">
            <strong>{{ lec.name }}</strong>
          </a>
          <br>
          <small class="text-muted">{{ lec.subjects }}</small>
        </td>
        <td class="text-center align-middle">
          {% if lec.complexity_avg is not none %}
          <span title="–°—Ä–µ–¥–Ω—è—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å: {{ lec.complexity_avg }}/10">üíÄ: {{ lec.complexity_avg }}</span>
          {% else %}
          <span class="text-muted">‚Äî</span>
          {% endif %}
        </td>
        <td class="text-center align-middle">
          {% if lec.interest_avg is not none %}
          <span title="–°—Ä–µ–¥–Ω–∏–π –∏–Ω—Ç–µ—Ä–µ—Å: {{ lec.interest_avg }}/10">‚≠êÔ∏è: {{ lec.interest_avg }}</span>
          {% else %}
          <span class="text-muted">‚Äî</span>
          {% endif %}
        </td>
        <td class="text-center align-middle">
          <strong style="font-size: 1.1em;">{{ lec.reviews }}</strong>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<style>
  .sortable:hover {
    background-color: #e9ecef;
  }

  .sort-arrow {
    font-size: 0.8em;
    color: #6c757d;
  }

  .sortable.asc .sort-arrow::before {
    content: "‚Üë";
  }

  .sortable.desc .sort-arrow::before {
    content: "‚Üì";
  }

  .sortable.asc .sort-arrow,
  .sortable.desc .sort-arrow {
    color: #0d6efd;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const table = document.getElementById('lecturers-table');
    const tbody = table.querySelector('tbody');
    let currentSort = { column: null, direction: 'asc' };

    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∏
    document.querySelectorAll('.sortable').forEach(header => {
      header.addEventListener('click', function () {
        const sortBy = this.dataset.sort;

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
        if (currentSort.column === sortBy) {
          currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
        } else {
          currentSort.direction = 'desc'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é –¥–ª—è —Ä–µ–π—Ç–∏–Ω–≥–æ–≤
          if (sortBy === 'name') {
            currentSort.direction = 'asc'; // –î–ª—è –∏–º–µ–Ω –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é
          }
        }
        currentSort.column = sortBy;

        // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
        document.querySelectorAll('.sortable').forEach(h => {
          h.classList.remove('asc', 'desc');
          h.querySelector('.sort-arrow').textContent = '‚Üï';
        });

        this.classList.add(currentSort.direction);

        // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫–∏
        sortTable(sortBy, currentSort.direction);
      });
    });

    function sortTable(column, direction) {
      const rows = Array.from(tbody.querySelectorAll('.lecturer-row'));

      rows.sort((a, b) => {
        let aVal, bVal;

        if (column === 'name') {
          aVal = a.dataset.name.toLowerCase();
          bVal = b.dataset.name.toLowerCase();
          return direction === 'asc' ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
        } else {
          aVal = parseFloat(a.dataset[column]) || 0;
          bVal = parseFloat(b.dataset[column]) || 0;
          return direction === 'asc' ? aVal - bVal : bVal - aVal;
        }
      });

      // –ü–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
      rows.forEach(row => tbody.appendChild(row));
    }

    // –ò–Ω–∏—Ü–∏–∞–ª—å–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)
    document.querySelector('[data-sort="complexity"]').click();
  });
</script>
{% endblock %}